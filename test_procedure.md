# 正确的测试步骤

## 准备工作
1. 先启动录像（确保录像正在进行）
2. 等待录像稳定运行至少1分钟

## 测试步骤

### 第1步：放入第一个CSV
- 记录时间（例如：18:30:00）
- 观察C#日志，应该看到：
  ```
  [CSV] 检测到新CSV文件: xxx
  [CSV] 时间: 2025-10-17 18:30:00
  [CSV] 创建新录像段, 开始时间: 2025-10-17 18:30:00
  ```
- **注意**：第一个CSV不会触发查询

### 第2步：等待足够的时间
- **至少等待5-10分钟**
- 让录像持续进行

### 第3步：放入第二个CSV
- 记录时间（例如：18:35:00）
- 观察C#日志，应该看到：
  ```
  [CSV] 检测到新CSV文件: xxx
  [CSV] 处理上一段录像:
        开始时间: 2025-10-17 18:30:00
        结束时间: 2025-10-17 18:35:00
        时长: 5.00 分钟
  [API] 调用录像查询API
  [API] Start Time: 2025-10-17 18:30:00
  [API] End Time: 2025-10-17 18:35:00
  [API] Duration: 5.00 分钟
  ```

### 第4步：检查Python API日志
应该看到：
```
[QUERY] Start Time: 2025-10-17 18:30:00
[QUERY] End Time: 2025-10-17 18:35:00
[QUERY] Duration: 5.00 minutes
[QUERY] 找到 5 个录像文件
```

## 常见错误

### ❌ 错误1：CSV间隔太短
- 如果两个CSV间隔只有几秒钟，查询时间范围太短
- 解决：确保间隔至少1分钟以上

### ❌ 错误2：录像未开始就放CSV
- 如果在录像开始前放入第一个CSV，会导致查询时间早于录像时间
- 解决：确保录像已经运行一段时间后再放入第一个CSV

### ❌ 错误3：时间同步问题
- 如果C#程序和Python API服务器时间不同步
- 解决：确保两边系统时间一致

## 日志关键检查点

1. **C#端**：
   - 两个CSV的时间差是否正确
   - API调用的时间范围是否合理

2. **Python API端**：
   - 接收到的查询时间是否正确
   - 找到了多少个录像文件
   - 每个文件的处理决策

## 预期结果

如果测试正确，5分钟的查询应该返回：
- 5个1分钟的录像文件（如果segment_duration=60）
- 或者相应数量的录像片段
- Session目录中可能有原文件路径和clip文件的混合